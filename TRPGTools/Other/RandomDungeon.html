<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ©ãƒ³ãƒ€ãƒ ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒãƒƒãƒ—ç”Ÿæˆ</title>
    <style>
        /* CSSã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ */
        #controls {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        label {
            font-weight: bold;
        }
        input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #aaa;
            border-radius: 3px;
        }
        button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #0056b3;
        }
        #dungeonCanvas {
            border: 1px solid #333;
            background-color: #111; /* èƒŒæ™¯è‰²ã‚’é»’ã«ã—ã¦éƒ¨å±‹ãŒæ˜ ãˆã‚‹ã‚ˆã†ã« */
        }
    </style>
</head>
<body>

    <h1>ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒãƒƒãƒ—ç”Ÿæˆãƒ„ãƒ¼ãƒ« ğŸ—ºï¸</h1>

    <div id="controls">
        <label for="minRooms">éƒ¨å±‹æ•° ä¸‹é™:</label>
        <input type="number" id="minRooms" value="5" min="1" max="100">

        <label for="maxRooms">éƒ¨å±‹æ•° ä¸Šé™:</label>
        <input type="number" id="maxRooms" value="10" min="1" max="100">
        
        <label for="drawCorridors">é€šè·¯ã‚’è¡¨ç¤º:</label>
        <input type="checkbox" id="drawCorridors" checked>
        
        <button onclick="generateMap()">ç”Ÿæˆ</button>
    </div>

    <canvas id="dungeonCanvas"></canvas>

    <script>
// ã€å®šæ•°è¨­å®šã€‘
const CANVAS_WIDTH = 800;  // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å¹…
const CANVAS_HEIGHT = 600; // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®é«˜ã•
const MIN_SIZE = 50;       // éƒ¨å±‹ã®æœ€å°ã®è¾ºã®é•·ã•
const MAX_SIZE = 150;      // éƒ¨å±‹ã®æœ€å¤§ã®è¾ºã®é•·ã•

// éƒ¨å±‹ã®æ§‹é€ ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®é…åˆ—
let rooms = [];

/**
 * HTMLã‹ã‚‰å€¤ã‚’å–å¾—ã—ã€ãƒãƒƒãƒ—ã‚’ç”Ÿæˆã—ã¦Canvasã«æç”»ã™ã‚‹
 */
function generateMap() {
    // ... (å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ã®å€¤å–å¾—ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã¯å¤‰æ›´ãªã—)
    const minRoomsInput = document.getElementById('minRooms');
    const maxRoomsInput = document.getElementById('maxRooms');

    // ï¸ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—
    const drawCorridorsCheckbox = document.getElementById('drawCorridors');
    const shouldDrawCorridors = drawCorridorsCheckbox.checked; // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚Œã° true

    const minRooms = parseInt(minRoomsInput.value);
    const maxRooms = parseInt(maxRoomsInput.value);

    if (
        isNaN(minRooms) || minRooms < 1 ||
        isNaN(maxRooms) || maxRooms < minRooms
    ) {
        alert("éƒ¨å±‹æ•°ã®è¨­å®šãŒä¸æ­£ã§ã™ã€‚\nä¸‹é™ã¯1ä»¥ä¸Šã€ä¸Šé™ã¯ä¸‹é™ä»¥ä¸Šã®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
    }

    const numberOfRooms = Math.floor(
        Math.random() * (maxRooms - minRooms + 1)
    ) + minRooms;
    
    const canvas = document.getElementById('dungeonCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = CANVAS_WIDTH;
    canvas.height = CANVAS_HEIGHT;
    
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

    rooms = []; // æç”»å‰ã«ã‚¯ãƒªã‚¢

    // éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã¨æç”»ãƒ«ãƒ¼ãƒ—ã‚’ä¿®æ­£
    for (let i = 0; i < numberOfRooms; i++) {
        const width = Math.floor(Math.random() * (MAX_SIZE - MIN_SIZE + 1)) + MIN_SIZE;
        const height = Math.floor(Math.random() * (MAX_SIZE - MIN_SIZE + 1)) + MIN_SIZE;

        const x = Math.floor(Math.random() * (CANVAS_WIDTH - width));
        const y = Math.floor(Math.random() * (CANVAS_HEIGHT - height));

        // â­ï¸ éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã«IDã‚’è¿½åŠ  (i + 1 ã§1ã‹ã‚‰ã®é€£ç•ª)
        const room = {
            id: i + 1, // éƒ¨å±‹ç•ªå·
            x, y, width, height,
            centerX: x + width / 2,
            centerY: y + height / 2
        };
        rooms.push(room);

        // éƒ¨å±‹ã®æç”» (æ˜ã‚‹ã„ç°è‰²)
        ctx.fillStyle = `rgba(180, 180, 180, 0.8)`;
        ctx.fillRect(x, y, width, height);

        // éƒ¨å±‹ã®æ ç·š (ç™½è‰²)
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y, width, height);

        // â­ï¸ éƒ¨å±‹ç•ªå·ã®ãƒ†ã‚­ã‚¹ãƒˆæç”»
        ctx.fillStyle = '#333'; // ãƒ†ã‚­ã‚¹ãƒˆã®è‰²
        ctx.font = 'bold 20px Arial'; // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã¨ç¨®é¡
        ctx.textAlign = 'center'; // æ°´å¹³æ–¹å‘ã®ä¸­å¿ƒæƒãˆ
        ctx.textBaseline = 'middle'; // å‚ç›´æ–¹å‘ã®ä¸­å¿ƒæƒãˆ
        ctx.fillText(room.id.toString(), room.centerX, room.centerY); // éƒ¨å±‹ç•ªå·ã‚’æç”»
    }

    // 5.ï¸ é€šè·¯ã®æ¥ç¶š (ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã«ã‚ˆã£ã¦å®Ÿè¡Œ)
    if (shouldDrawCorridors) {
        drawCorridors(ctx);
    }
}

/**
 * ç”Ÿæˆã•ã‚ŒãŸéƒ¨å±‹ã®ä¸­å¿ƒç‚¹åŒå£«ã‚’çµã³ã¤ã‘ã¦é€šè·¯ã‚’æç”»ã™ã‚‹
 * (ç°¡å˜ãªæ–¹æ³•ã¨ã—ã¦ã€é…åˆ—é †ã«éš£æ¥ã™ã‚‹éƒ¨å±‹ã‚’çµã¶)
 */
function drawCorridors(ctx) {
if (rooms.length < 2) return;

    ctx.strokeStyle = '#555'; // é€šè·¯ã®è‰² (æš—ã„ç°è‰²)
    ctx.lineWidth = 5;       // é€šè·¯ã®å¹…

    for (let i = 0; i < rooms.length - 1; i++) {
        const roomA = rooms[i];
        const roomB = rooms[i + 1];

        // å„éƒ¨å±‹ã®ä¸­å¿ƒåº§æ¨™
        const x1 = roomA.centerX;
        const y1 = roomA.centerY;
        const x2 = roomB.centerX;
        const y2 = roomB.centerY;

        ctx.beginPath();
        ctx.moveTo(x1, y1);

        // Lå­—å‹ã¨Hå­—å‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
        if (Math.random() < 0.5) {
            // Lå­—å‹ (Xè»¸ç§»å‹• â†’ Yè»¸ç§»å‹•)
            ctx.lineTo(x2, y1); // roomAã®Yåº§æ¨™ã‚’ä¿ã¡ã¤ã¤ã€roomBã®Xåº§æ¨™ã¾ã§ç§»å‹•
            ctx.lineTo(x2, y2); // roomBã®Xåº§æ¨™ã‚’ä¿ã¡ã¤ã¤ã€roomBã®Yåº§æ¨™ã¾ã§ç§»å‹•
        } else {
            // Hå­—å‹ (Yè»¸ç§»å‹• â†’ Xè»¸ç§»å‹•)
            ctx.lineTo(x1, y2); // roomAã®Xåº§æ¨™ã‚’ä¿ã¡ã¤ã¤ã€roomBã®Yåº§æ¨™ã¾ã§ç§»å‹•
            ctx.lineTo(x2, y2); // roomBã®Yåº§æ¨™ã‚’ä¿ã¡ã¤ã¤ã€roomBã®Xåº§æ¨™ã¾ã§ç§»å‹•
        }
        
        ctx.stroke();
    }
}
    </script>

</body>
</html>